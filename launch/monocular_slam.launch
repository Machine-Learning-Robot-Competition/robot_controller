<launch>
  <!-- Basic parameters -->
  <param name="use_sim_time" type="bool" value="True"/>
  <arg name="rtabmap_args" default="--delete_db_on_start"/>
  <arg name="localization" default="false"/>

  <!-- Static transforms -->
  <!-- Uncomment this if you don't have a transform from odom to base footprint in your URDF -->
  <!-- <node pkg="tf2_ros" type="static_transform_publisher" name="odom_to_basefootprint" args="0 0 0 0 0 0 B1_tf/odom B1_tf/base_footprint" /> -->
  <node pkg="tf" type="static_transform_publisher" name="base_to_camera_tf" args="x y z roll pitch yaw B1_tf/base_footprint B1_tf/camera_link 10" />

  <!-- SLAM Node Configuration for Monocular Camera -->
  <node name="rtabmap" pkg="rtabmap_slam" type="rtabmap" output="screen" args="$(arg rtabmap_args)">
    <param name="frame_id" type="string" value="B1_tf/base_footprint"/>
    <param name="odom_frame_id" type="string" value="B1_tf/odom"/>
    <param name="wait_for_transform" type="bool" value="true"/>
    
    <!-- Enable monocular SLAM mode -->
    <param name="subscribe_depth" type="bool" value="false"/>
    <param name="subscribe_rgbd" type="bool" value="false"/>
    <param name="subscribe_stereo" type="bool" value="false"/>
    <param name="subscribe_scan" type="bool" value="false"/>

    <!-- Remap camera topics to use RGB monocular data -->
    <remap from="rgb/image" to="/B1/rrbot/camera1/image_raw"/>
    <remap from="rgb/camera_info" to="/B1/rrbot/camera1/camera_info"/>

    <!-- Configure image transport for monocular SLAM -->
    <param name="rgb/image_transport" type="string" value="raw"/>

    <!-- RTAB-Map parameters for monocular mode -->
    <param name="RGBD/ProximityBySpace" type="string" value="true"/> <!-- Enable local loop closure detection -->
    <param name="Mem/IncrementalMemory" type="bool" value="true"/> <!-- Allow incremental mapping -->
    <param name="Mem/InitWMWithAllNodes" type="bool" value="true"/>
  </node>

  <!-- Visualization Node -->
  <node pkg="rtabmap_viz" type="rtabmap_viz" name="rtabmap_viz" output="screen">
    <param name="subscribe_depth" type="bool" value="false"/>
    <param name="frame_id" type="string" value="B1_tf/base_footprint"/>
    <param name="wait_for_transform" type="bool" value="true"/>

    <!-- Remap camera topics for visualization -->
    <remap from="rgb/image" to="/B1/rrbot/camera1/image_raw"/>
    <remap from="rgb/camera_info" to="/B1/rrbot/camera1/camera_info"/>
  </node>

  <!-- Optional: RVIZ for additional visualization (uncomment if needed) -->
  <!--
  <node pkg="rviz" type="rviz" name="rviz" args="-d $(find rtabmap_demos)/launch/config/demo_robot_mapping.rviz" output="screen"/>
  -->
</launch>